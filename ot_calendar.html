<html>
<head>
<script type="text/javascript">

function chooseMonth() {
	date = new Date();
	
	html='<p>Choose a month and year: <select id="selMonth" onchange="makeCalendar()">';
	
	months = new Array('January','February','March','April','May','June','July','August','September','October','November','December');
	
	for (i=0; i<months.length; i++) {
		html+='<option value="' + months[i] + '">'+months[i]+'</option>\n';
	}
	
	html+= '</select> <select id="selYear" onchange="makeCalendar()">';
	
	thisYear=date.getFullYear();
	
	for(i=thisYear-5;i<thisYear+5;i++) {
		html+='<option value="' + i + '">'+i+'</option>\n';
	}
	html+='</p>'
	return html;
}

function chooseDays() {
	html = '<p>Which days of the week do you work?  Leave everything unchecked if you want to put hours for every day.<br><table border="1"><tr>';
	
	days = new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday');
	
	for (i = 0; i < days.length; i++) {
		html += '<td>' + days[i] + '</td>';
	}
	
	html += '</tr><tr>';
	for (i = 0; i < days.length; i++) {
		html += '<td><input type = "checkBox" id = "day' + i + '" /></td>';
	}
	
	return html;
}

function getWeekHours() {
  date = new Date(document.getElementById("selYear").value, document.getElementById("selMonth").selectedIndex, 1);
  
  html = '';
  
  dayOfWeek = date.getDay();
  
  if (dayOfWeek > 0) {
	  html += 'Please enter the number of hours you reported on the following days.<br /><table>';
	lastMonthDays = new Date(+date); 
	
	lastMonthDays.setDate(-1);
	lastMonthDays.setDate(lastMonthDays.getDate()-dayOfWeek+2);
	  while (lastMonthDays.getMonth() != date.getMonth()) {
		html += '<tr><th>' + lastMonthDays.toDateString() + '</th><td><input type="text" class="lastMonthHours" size = "5" maxLength="2"> hours <input type="text" class="lastMonthMinutes" size = "5" maxLength="2"> minutes</td><td><b><font color="#FF0000" class="lastMonthError" /></b> </td></tr>';
		
		lastMonthDays.setDate(lastMonthDays.getDate()+1);
	  }
  }
  
  return html;
}

function makeCalendar() {
	
	document.getElementById("lastMonthWeeklyDiv").innerHTML = getWeekHours();
	
  date = new Date(document.getElementById("selYear").value, document.getElementById("selMonth").selectedIndex, 1);

  day = date.getDate();
  month = date.getMonth();
  year = date.getFullYear();
  
  week=0

  months = new Array('January','February','March','April','May','June','July','August','September','October','November','December');
  days = new Array('Sunday','Monday','Tuesday','Wednesday','Thursday','Friday','Saturday');

  this_month = new Date(year, month, 1);
  next_month = new Date(year, month + 1, 1);

  // Find out when this month starts and ends.
  first_week_day = this_month.getDay();
  days_in_this_month = Math.round((next_month.getTime() - this_month.getTime()) / (1000 * 60 * 60 * 24));

  calendar_html = '<table border = "1">';
  calendar_html += '<tr height="75px"><td colspan="8" style="text-align: center;"><h3>' + months[month] + ' ' + year + '</h3></td></tr><tr></tr>';
  
  for(week_day = 0; week_day < days.length; week_day++) {
    calendar_html += '<th>' + days[week_day] + '</th>';
  }
  
  calendar_html += '<th>Weekly Total</th>';
  
  calendar_html += '<tr>';
  
	dateRow=true
  // Fill the first week of the month with the appropriate number of blanks.
  for(week_day = 0; week_day < first_week_day; week_day++) {
    calendar_html += '<td></td>';
  }

  week_day = first_week_day;
  var day_counter;
  for(day_counter = 1; day_counter <= days_in_this_month; day_counter++) {
    week_day %= 7;
    if(week_day == 0) {
		if (!dateRow) {
      calendar_html += '<th class="week">0</th></tr><tr>';
  } else {
	  calendar_html += '</tr><tr>';
	  day_counter-=7;
      week++;	  
  }
 		dateRow=!dateRow     

  }
	if (dateRow) {
  calendar_html += '<th style="text-align: center;" height="25px">' + day_counter + ' </th>';
  } else {
	calendar_html += '<th class = "week' + week + '" style="text-align: center;" height="50px"> </th>';
  }
    week_day++;
  }
  
  // Fill the last week of the month with the appropriate number of blanks.
  for(i=week_day; i < 7; i++) {
    calendar_html += '<td > </td>';
  }
  calendar_html += '</tr><tr>';
  // Fill the last week of the month with the appropriate number of result boxes.
  day_counter -= week_day;
  for(i=1; i < 8; i++) {
	  if (i<=week_day && day_counter <= days_in_this_month) {
		  calendar_html += '<td class="week' + week + '" style="text-align: center;" height="50px"></td>';
	  } else {
    calendar_html += '<td > </td>';
  }
}

      calendar_html += '<th class="week">0</th></tr><tr>';

  calendar_html += '</tr>';
  calendar_html += '</table>';

  // Display the calendar.
  document.getElementById("resultCalendar").innerHTML = calendar_html;
}

function validateTopInput() {
	document.getElementById("monthlyHoursError").innerHTML = ''
	document.getElementById("exemptionError").innerHTML = ''
	
	if (isNaN(document.getElementById("monthlyHours").value.trim()) || isNaN(document.getElementById("monthlyMinutes").value.trim())) {
		document.getElementById("monthlyHoursError").innerHTML = "You have entered something that isn't a number.<br>Please check what you've entered.";
		return false;
	}
	
	if (document.getElementById("exemptionOther").checked && (isNaN(document.getElementById("otherHours").value.trim()) || isNaN(document.getElementById("otherMinutes").value.trim()))) {
		document.getElementById("exemptionError").innerHTML = "You have entered something that isn't a number.<br>Please check what you've entered.";
		return false;
	}
	
	return true;
}

function validateInput() {
	if (!validateTopInput()) {
		return false;
	}
	
	lastMonthHours=document.getElementsByClassName("lastMonthHours");
	lastMonthMinutes=document.getElementsByClassName("lastMonthMinutes");
	for (i=0;i<lastMonthHours.length;i++) {
		if (isNaN(lastMonthHours[i].value.trim()) || isNaN(lastMonthMinutes[i].value.trim())) {
			document.getElementsByClassName("lastMonthError")[i].innerHTML = "You have entered something that isn't a number.<br>Please check what you've entered.";
				return false;			
		} else {
			document.getElementsByClassName("lastMonthError")[i].innerHTML = '';
		}

	}
	
	return true;
}

function calcWeekly() {
	
	html = 'Invalid Input';
	
	if (validateTopInput()) {
		
		weeklyHoursBox = 0;
		if (document.getElementById('monthlyHours').value.trim() != '') {
			weeklyHoursBox = parseFloat(document.getElementById('monthlyHours').value.trim());
		}
		
		weeklyMinutesBox = 0;
		if (document.getElementById('monthlyMinutes').value.trim() != '') {
			weeklyMinutesBox = parseFloat(document.getElementById('monthlyMinutes').value.trim());
		}
		
		weeklyHoursDec = (weeklyHoursBox + (weeklyMinutesBox/60)) / 4;
		
		weeklyHoursDec = max(weeklyHoursDec, 66);
		
		if (document.getElementById('exemption90').checked && weeklyHoursDec < 90) {
			weeklyHoursDec = 90;
		} else if(document.getElementById('exemption7075').checked && weeklyHoursDec < 70.75) {
			weeklyHoursDec = 70.75;
		}
		
		
		if (document.getElementById('exemptionOther').checked) {
			otherHoursBox = 0;
			if (document.getElementById('otherHours').value.trim() != '') {
				otherHoursBox = parseFloat(document.getElementById('otherHours').value.trim());
			}
			
			otherMinutesBox = 0;
			if (document.getElementById('otherMinutes').value.trim() != '') {
				otherMinutesBox = parseFloat(document.getElementById('otherMinutes').value.trim());
			}
			
			otherHoursDec = (otherHoursBox + (otherMinutesBox/60));
			
			weeklyHoursDec = Math.max(weeklyHoursDec, otherHoursDec);
		}
		
		weeklyHours = Math.floor(weeklyHoursDec);
		weeklyMinutes = Math.ceil((weeklyHoursDec - weeklyHours) * 60);		
		
		html = weeklyHours + ' hours ' + weeklyMinutes + ' minutes ';
			
	}
	
	document.getElementById('weeklyHours').innerHTML = html;
}

function doGenerate() {
	
	if (validateInput()) {
		
	}
}

//calendar();


</script>
</head>

<body>


<h3>Overtime Hours Calendar Generator</h3>

<p>text goes here</p>


<table border="1" borderstyle="flat">
<tr><td><b>Enter your monthly hours: </b></td>
<td><input type="text" id="monthlyHours" size = "5" maxLength="3" onkeyup="calcWeekly()"/> hours <input type="text" id="monthlyMinutes" size = "5" maxLength="2" onkeyup="calcWeekly()"/> minutes
<td><b><font color="#FF0000" id="monthlyHoursError" /></b></td></tr>

<tr><td><b>Do you qualify for an exemption?</b></td>
<td><input type="checkbox" id="exemption90"  onchange="calcWeekly()"/>90 hours per week family exemption<br /> <input type="checkbox" id="exemption7075"  onchange="calcWeekly()"/>One Provider for One Client<br /> <input type="checkbox" id="exemptionOther"  onchange="calcWeekly()"/> Other Exemption <input type="text" id="otherHours" size = "5" maxLength="3" onkeyup="calcWeekly()"/> hours <input type="text" id="otherMinutes" size = "5" maxLength="2" onkeyup="calcWeekly()"/> minutes per week</td><td><b><font color="#FF0000" id="exemptionError" /></b> </td></tr>

<tr><td><b>Maximum Weekly Hours</b></td><td colspan="2" id="weeklyHours">Enter Numbers Above</td></tr>

</table>

<div id="selDaysDiv"></div>
<div id="selMonthDiv"></div>

<div id="lastMonthWeeklyDiv"></div>
<p id="resultCalendar"></p>

<script>
document.getElementById("selDaysDiv").innerHTML = chooseDays();
document.getElementById("selMonthDiv").innerHTML = chooseMonth();

document.getElementById("selYear").selectedIndex =5;
document.getElementById("selMonth").selectedIndex = new Date().getMonth();
document.getElementById("lastMonthWeeklyDiv").innerHTML = getWeekHours();
makeCalendar();
</script>

<button type="button" onClick="doGenerate()">Create My Timesheet</button>

</body>
</html>
